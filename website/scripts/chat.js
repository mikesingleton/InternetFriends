"use strict";var User=function(e,t){function n(){d.text().length>0&&(u.say(d.text()),p(d.text()),d.text(""))}function o(){d.is(":visible")}function a(){d&&(d.keydown(function(e){13==e.keyCode?e.preventDefault():0==d.text().length&&8==e.keyCode&&o()}),d.keyup(function(e){13==e.keyCode&&(n(),e.preventDefault())}))}function s(){r.css("top",c.y+"px"),r.css("left",c.x+"px")}var u={},i=null,c={},r=null,l=null,d=null,f=null,g=-1,m=-1,p=t;return u.init=function(e){if(i=e,c={x:0,y:0},r=$('<div id="'+e+'" class="user"></div>').appendTo($("body")),l=$('<p class="speech fadeout"></p>').appendTo(r),Logger.log(i),"localuser"==i)d=$('<span contenteditable="true" class="input"></span>').appendTo(r),a();else{var t=chrome&&chrome.extension?chrome.extension.getURL("../../images/aero_arrow.cur"):"./images/aero_arrow.cur";f=$('<div class="fakeMouse"></div>').appendTo(r),_mouseBGElm=$('<div class="fakeMouseBackgroundColor"></div>').appendTo(f),_mouseBGElm.css({"background-image":"url("+t+")"})}},u.focusInput=function(){d&&(d.blur(),d.focus())},u.setMousePosition=function(e,t){c.x=e,c.y=t,s(),f&&(f.removeClass("fadeout"),clearTimeout(m),m=setTimeout(function(){f.addClass("fadeout")},5e3))},u.say=function(e){l.removeClass("fadeout"),l.html(e),clearTimeout(g),g=setTimeout(function(){l.addClass("fadeout")},2e3),f&&(f.removeClass("fadeout"),clearTimeout(m),m=setTimeout(function(){f.addClass("fadeout")},5e3))},u.init(e),u};Logger.log("init chat.js");var Chat=function(){function e(e){switch(Logger.log("got chat message",e),e.event){case"scroll":o(e.data);break;case"mousemove":a(e.data);break;case"mouseleave":s(e.data);break;case"enterpressed":u(e.data);break;case"userchat":i(e.data)}}function t(e){var t={message:e};r.tell("userchat",t)}function n(e){return l[e]||(l[e]=new User(e,t)),l[e]}function o(e){d.x=e.scrollX,d.y=e.scrollY}function a(e){var t=n(e.userId),o=e.y-d.y,a=e.x-d.x;t.setMousePosition(a,o)}function s(e){}function u(e){var t=n(e.userId);t.focusInput(),Logger.log("focus input")}function i(e){var t=n(e.userId);t.say(e.message)}var c={},r=null,l={},d={};return c.init=function(){Logger.log("init chat"),r=new portManager("chat",e),d={x:0,y:0}},c}();document.addEventListener("DOMContentLoaded",function(){new Chat.init},!1);
//# sourceMappingURL=chat.js.map
