{"version":3,"sources":["backgroundPortManager.js"],"names":["_backgroundPortManager","backgroundPortManager","messageCallback","roomDisconnectCallback","_this","_openTabs","_messageCallback","_roomDisconnectCallback","init","this","_portManagers","length","i","processTabPortConnected","Logger","log","port","tabId","source","roomCode","postMessage","event","data","message","userId","tellByTabId","tellByRoomCode"],"mappings":"AAAA,YAEAA,wBAAyB,IAEzB,IAAIC,uBAAwB,SAA+BC,EAAiBC,GAE1E,GAAIC,MACAC,KACAC,EAAmB,KACnBC,EAA0B,IAqF9B,OAnFAH,GAAMI,KAAO,SAAUN,EAAiBC,GAKtC,GAJAG,EAAmBJ,EACnBK,EAA0BJ,EAC1BH,uBAAyBS,KAErBC,eAAiBA,cAAcC,OACjC,IAAK,GAAIC,GAAI,EAAGA,EAAIF,cAAcC,OAAQC,IACxCR,EAAMS,wBAAwBH,cAAcE,GAIhDE,QAAOC,IAAI,+BAKbX,EAAMS,wBAA0B,SAAUG,GACxC,GAAIC,GAAQ,EACRC,EAASF,EAAKE,OACdC,EAAW,wBACfL,QAAOC,IAAI,kBAAoBE,GAE1BZ,EAAUY,KAAQZ,EAAUY,OACjCZ,EAAUY,GAAOC,GAAUF,EAEvBX,EAAUY,GAAO,yBAA2BZ,EAAUY,GAAO,0BAC/DZ,EAAUY,GAAO,wBAAwBG,aACvCC,MAAO,SACPC,UAGFjB,EAAUY,GAAO,wBAAwBG,aACvCC,MAAO,SACPC,WAIJhB,GACEe,MAAO,eACPC,SACCH,IAILf,EAAMgB,YAAc,SAAUG,EAASN,EAAOC,EAAQC,GACpDb,EAAiBiB,EAASJ,GAIZ,wBAAVD,IACFK,EAAQD,KAAKE,OAAS,YAEtBpB,EAAMqB,YAAY,EAAGF,KAIzBnB,EAAMsB,eAAiB,SAAUP,EAAUG,GACzC,GAAIL,GAAQ,CAEZ,SAAIZ,EAAUY,GAAO,0BACnBZ,EAAUY,GAAO,wBAAwBG,YAAYE,IAE9C,IAMXlB,EAAMqB,YAAc,SAAUR,EAAOK,GACnC,GAAIL,GAAQ,CAEZ,UAAIZ,EAAUY,KAAUZ,EAAUY,GAAO,2BACvCZ,EAAUY,GAAO,wBAAwBG,YAAYE,IAE9C,IAOXlB,EAAMI,KAAKN,EAAiBC,GAErBC","file":"backgroundPortManager.js","sourcesContent":["\"use strict\";\n\n_backgroundPortManager = null;\n\nvar backgroundPortManager = function backgroundPortManager(messageCallback, roomDisconnectCallback) {\n  // variables ----------------------------------------------------------------\n  var _this = {},\n      _openTabs = {},\n      _messageCallback = null,\n      _roomDisconnectCallback = null; // initialize ---------------------------------------------------------------\n\n  _this.init = function (messageCallback, roomDisconnectCallback) {\n    _messageCallback = messageCallback;\n    _roomDisconnectCallback = roomDisconnectCallback;\n    _backgroundPortManager = this;\n\n    if (_portManagers && _portManagers.length) {\n      for (var i = 0; i < _portManagers.length; i++) {\n        _this.processTabPortConnected(_portManagers[i]);\n      }\n    }\n\n    Logger.log('backgroundPortManager init');\n  }; // private functions --------------------------------------------------------\n  // events -------------------------------------------------------------------\n\n\n  _this.processTabPortConnected = function (port) {\n    var tabId = 1;\n    var source = port.source;\n    var roomCode = \"internetfriendswebsite\";\n    Logger.log('tab connected: ' + tabId); // Add port to tab\n\n    if (!_openTabs[tabId]) _openTabs[tabId] = {};\n    _openTabs[tabId][source] = port;\n\n    if (_openTabs[tabId]['InternetFriends-chat'] && _openTabs[tabId]['InternetFriends-main']) {\n      _openTabs[tabId]['InternetFriends-main'].postMessage({\n        event: 'loaded',\n        data: {}\n      });\n\n      _openTabs[tabId]['InternetFriends-chat'].postMessage({\n        event: 'loaded',\n        data: {}\n      });\n    }\n\n    _messageCallback({\n      event: 'tabConnected',\n      data: {}\n    }, roomCode);\n  }; // public functions ---------------------------------------------------------\t\n\n\n  _this.postMessage = function (message, tabId, source, roomCode) {\n    _messageCallback(message, roomCode); //Logger.log(message);\n    // Forward to iframe\n\n\n    if (source != 'InternetFriends-chat') {\n      message.data.userId = \"localuser\";\n\n      _this.tellByTabId(1, message);\n    }\n  };\n\n  _this.tellByRoomCode = function (roomCode, data) {\n    var tabId = 1;\n\n    if (_openTabs[tabId][\"InternetFriends-chat\"]) {\n      _openTabs[tabId][\"InternetFriends-chat\"].postMessage(data);\n\n      return true;\n    }\n\n    return false;\n  };\n\n  _this.tellByTabId = function (tabId, data) {\n    var tabId = 1;\n\n    if (_openTabs[tabId] && _openTabs[tabId][\"InternetFriends-chat\"]) {\n      _openTabs[tabId][\"InternetFriends-chat\"].postMessage(data);\n\n      return true;\n    }\n\n    return false;\n  }; // messages -----------------------------------------------------------------\t\n\n\n  _this.init(messageCallback, roomDisconnectCallback);\n\n  return _this;\n};"]}